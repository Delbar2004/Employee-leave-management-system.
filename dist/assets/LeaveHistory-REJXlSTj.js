import{r as i,Q as h,j as e,L as b,C as y,X as S,d as T}from"./index-uPpi8n1S.js";import{l as k}from"./leaveService-CJtUEa2x.js";import{S as F,F as z,C as A,a as q,R as E}from"./search-BdZlJNNC.js";import{f as d}from"./format-BZscouVm.js";import{p as n}from"./parseISO-Yj3askoI.js";const Q=()=>{const[x,g]=i.useState([]),[m,u]=i.useState([]),[w,p]=i.useState(!0),[s,j]=i.useState(null),[o,D]=i.useState(!1),[t,v]=i.useState({status:"",type:"",startDate:"",endDate:"",searchTerm:""});i.useEffect(()=>{N()},[]);const N=async()=>{try{p(!0);const a=await k.getMyLeaveRequests();g(a),u(a)}catch(a){console.error("Error fetching leave requests:",a),h.error("Failed to load leave requests")}finally{p(!1)}};i.useEffect(()=>{let a=[...x];if(t.status&&(a=a.filter(r=>r.status===t.status)),t.type&&(a=a.filter(r=>r.leaveType===t.type)),t.startDate){const r=new Date(t.startDate);a=a.filter(l=>new Date(l.startDate)>=r)}if(t.endDate){const r=new Date(t.endDate);a=a.filter(l=>new Date(l.endDate)<=r)}if(t.searchTerm){const r=t.searchTerm.toLowerCase();a=a.filter(l=>l.leaveType.toLowerCase().includes(r)||l.reason.toLowerCase().includes(r))}u(a)},[t,x]);const c=a=>{const{name:r,value:l}=a.target;v(R=>({...R,[r]:l}))},C=()=>{v({status:"",type:"",startDate:"",endDate:"",searchTerm:""})},M=async a=>{if(window.confirm("Are you sure you want to cancel this leave request?"))try{await k.cancelLeaveRequest(a),g(r=>r.map(l=>l.id===a?{...l,status:"cancelled"}:l)),j(r=>r&&r.id===a?{...r,status:"cancelled"}:r),h.success("Leave request cancelled successfully")}catch(r){console.error("Error cancelling leave request:",r),h.error("Failed to cancel leave request")}},f=a=>{switch(a){case"approved":return"bg-success-100 text-success-800 dark:bg-success-900/30 dark:text-success-300";case"pending":return"bg-accent-100 text-accent-800 dark:bg-accent-900/30 dark:text-accent-300";case"rejected":return"bg-error-100 text-error-800 dark:bg-error-900/30 dark:text-error-300";case"cancelled":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},L=Array.from(new Set(x.map(a=>a.leaveType)));return w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-600 dark:bg-primary-400 animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-600 dark:bg-primary-400 animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-600 dark:bg-primary-400 animate-bounce",style:{animationDelay:"300ms"}})]})}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Leave History"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"View and manage all your leave requests"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0",children:[e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(F,{size:16,className:"text-gray-500 dark:text-gray-400"})}),e.jsx("input",{type:"text",className:"input pl-10 w-full",placeholder:"Search requests...",name:"searchTerm",value:t.searchTerm,onChange:c})]}),e.jsxs("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>D(!o),className:"btn btn-outline px-3 py-2",children:[e.jsx(z,{size:16,className:"mr-2"}),"Filters",o?e.jsx(A,{size:16,className:"ml-2"}):e.jsx(q,{size:16,className:"ml-2"})]}),e.jsx("button",{onClick:N,className:"btn btn-outline px-3 py-2","aria-label":"Refresh",children:e.jsx(E,{size:16})}),e.jsxs(b,{to:"/leave/apply",className:"btn btn-primary px-3 py-2",children:[e.jsx(y,{size:16,className:"mr-2"}),"Apply for Leave"]})]})]}),o&&e.jsxs("div",{className:"card mb-6 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"label",children:"Status"}),e.jsxs("select",{id:"status",name:"status",className:"input",value:t.status,onChange:c,children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"label",children:"Leave Type"}),e.jsxs("select",{id:"type",name:"type",className:"input",value:t.type,onChange:c,children:[e.jsx("option",{value:"",children:"All Types"}),L.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"label",children:"From Date"}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",className:"input",value:t.startDate,onChange:c})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"label",children:"To Date"}),e.jsx("input",{type:"date",id:"endDate",name:"endDate",className:"input",value:t.endDate,onChange:c})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:C,className:"btn btn-outline px-3 py-2",children:[e.jsx(S,{size:16,className:"mr-2"}),"Reset Filters"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["Leave Requests",e.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",m.length,")"]})]})}),m.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:m.map(a=>e.jsxs("div",{className:`p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors cursor-pointer ${(s==null?void 0:s.id)===a.id?"bg-gray-50 dark:bg-gray-800":""}`,onClick:()=>j(a),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:a.leaveType}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[d(n(a.startDate),"MMM dd, yyyy")," - ",d(n(a.endDate),"MMM dd, yyyy")]})]}),e.jsx("span",{className:`badge ${f(a.status)} capitalize`,children:a.status})]}),e.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(T,{size:14,className:"mr-1"}),e.jsxs("span",{children:[a.duration," day",a.duration!==1?"s":""]}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsxs("span",{children:["Applied on ",d(n(a.appliedOn),"MMM dd, yyyy")]})]}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Reason: "}),e.jsx("span",{className:"text-gray-800 dark:text-gray-200",children:a.reason.length>100?`${a.reason.substring(0,100)}...`:a.reason})]})]},a.id))}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No leave requests found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:t.status||t.type||t.startDate||t.endDate||t.searchTerm?"Try adjusting your filters to see more results":"Apply for a new leave to see it listed here"}),e.jsx(b,{to:"/leave/apply",className:"btn btn-primary",children:"Apply for Leave"})]})]})}),e.jsx("div",{children:s?e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex justify-between items-start",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Request Details"}),e.jsx("span",{className:`badge ${f(s.status)} capitalize`,children:s.status})]}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Leave Type"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:s.leaveType})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Start Date"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:d(n(s.startDate),"MMM dd, yyyy")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"End Date"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:d(n(s.endDate),"MMM dd, yyyy")})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Duration"}),e.jsxs("p",{className:"mt-1 text-gray-900 dark:text-white",children:[s.duration," working day",s.duration!==1?"s":""]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Reason"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white whitespace-pre-line",children:s.reason})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Applied On"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:d(n(s.appliedOn),"MMM dd, yyyy")})]}),s.reviewedOn&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Reviewed On"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:d(n(s.reviewedOn),"MMM dd, yyyy")})]})]}),s.reviewedBy&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Reviewed By"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:s.reviewedBy})]}),s.comments&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Comments"}),e.jsx("p",{className:"mt-1 text-gray-900 dark:text-white",children:s.comments})]}),s.status==="pending"&&e.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{onClick:()=>M(s.id),className:"btn btn-outline border-error-500 text-error-600 hover:bg-error-50 dark:border-error-700 dark:text-error-400 dark:hover:bg-error-900/20",children:"Cancel Request"})})]})})]}):e.jsx("div",{className:"card p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-4",children:e.jsx(y,{size:24,className:"text-gray-500 dark:text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:"No request selected"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Select a leave request to view details"})]})})})]})]})};export{Q as default};
